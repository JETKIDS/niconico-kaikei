<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚‚ã†ã‹ã‚Šã¾ã£ã‹</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <button 
                class="manual-button" 
                id="manual-button"
                type="button"
                aria-label="æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã"
                title="æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’é–‹ã"
                tabindex="0"
                onclick="if(!window.manualButtonManager || !window.manualButtonManager.isInitialized) { window.open('manual.html', '_blank', 'noopener,noreferrer'); }">
                <span class="manual-button-icon" aria-hidden="true">ğŸ“–</span>
                <span class="manual-button-text">ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</span>
            </button>
            
            <!-- JavaScriptç„¡åŠ¹æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ -->
            <noscript>
                <a href="manual.html" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   class="manual-button manual-button-noscript"
                   title="æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’é–‹ãï¼ˆJavaScriptç„¡åŠ¹ï¼‰"
                   style="display: inline-block; text-decoration: none; position: absolute; top: 1rem; left: 1.5rem;">
                    <span class="manual-button-icon" aria-hidden="true">ğŸ“–</span>
                    <span class="manual-button-text">ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</span>
                </a>
            </noscript>
            <h1>ã‚‚ã†ã‹ã‚Šã¾ã£ã‹ <span class="version-display" id="app-version">v1.0.0</span></h1>
            <div class="header-controls">
                <div id="save-status" class="save-status">
                    <span id="save-status-text">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</span>
                    <span id="save-status-icon" class="save-status-icon">â³</span>
                </div>
                <div id="global-store-selector" class="global-store-selector">
                    <!-- åº—èˆ—ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã¯å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                <div id="global-date-selector" class="global-date-selector">
                    <label for="global-year">è¡¨ç¤ºå¹´:</label>
                    <select id="global-year" onchange="app.changeGlobalDate()">
                        <!-- å¹´ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯å‹•çš„ã«ç”Ÿæˆ -->
                    </select>
                    <label for="global-month">è¡¨ç¤ºæœˆ:</label>
                    <select id="global-month" onchange="app.changeGlobalDate()">
                        <!-- æœˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯å‹•çš„ã«ç”Ÿæˆ -->
                    </select>
                </div>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="#sales" class="nav-link active" data-section="sales">å£²ä¸Šç®¡ç†</a></li>
                    <li><a href="#purchases" class="nav-link" data-section="purchases">ä»•å…¥ã‚Œç®¡ç†</a></li>
                    <li><a href="#fixed-costs" class="nav-link" data-section="fixed-costs">å›ºå®šè²»</a></li>
                    <li><a href="#variable-costs" class="nav-link" data-section="variable-costs">å¤‰å‹•è²»</a></li>
                    <li><a href="#labor-costs" class="nav-link" data-section="labor-costs">äººä»¶è²»</a></li>

                    <li><a href="#consumption-tax" class="nav-link" data-section="consumption-tax">æ¶ˆè²»ç¨</a></li>
                    <li><a href="#monthly-payments" class="nav-link" data-section="monthly-payments">æœˆã€…ã®è¿”æ¸ˆ</a></li>
                    <li><a href="#manufacturer-deposits" class="nav-link"
                            data-section="manufacturer-deposits">ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼é‡‘</a></li>
                    <li><a href="#reports" class="nav-link" data-section="reports">åæ”¯ãƒ¬ãƒãƒ¼ãƒˆ</a></li>
                    <li><a href="#stores" class="nav-link" data-section="stores">åº—èˆ—ç®¡ç†</a></li>
                    <li><a href="#backup" class="nav-link" data-section="backup">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <div id="content-area">
                <!-- Dynamic content will be loaded here -->
            </div>
        </main>

        <footer>
            <p>&copy; å¤§æœ¬å–¶æœƒè¨ˆæ©Ÿæ§‹æ ªå¼ä¼šç¤¾</p>
        </footer>
    </div>

    <!-- Include Chart.js library from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" 
            onload="console.log('âœ“ Chart.js loaded from CDN')"
            onerror="console.warn('Chart.js CDN failed - trying local fallback'); 
                     var script = document.createElement('script'); 
                     script.src = 'lib/chart.min.js'; 
                     script.onerror = function() { console.warn('Chart.js library not found - charts will not work'); }; 
                     document.head.appendChild(script);"></script>
    
    <!-- Version Management System -->
    <script src="js/version.js"></script>
    <script src="js/version-utils.js"></script>
    
    <!-- Include application scripts in dependency order -->
    <script>
        // ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿çŠ¶æ³ã‚’è¿½è·¡
        window.scriptLoadStatus = {
            dataManager: false,
            storeManager: false,
            uiManager: false,
            chartManager: false,
            app: false
        };
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°é–¢æ•°
        function handleScriptError(scriptName, error) {
            console.error(`${scriptName} ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:`, error);
            
            // XSSå¯¾ç­–ï¼šãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å®‰å…¨ã«è¨­å®š
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'padding: 20px; background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 4px; margin: 20px;';
            
            const title = document.createElement('h2');
            title.textContent = 'ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼';
            
            const message1 = document.createElement('p');
            const strong = document.createElement('strong');
            strong.textContent = scriptName;
            message1.appendChild(strong);
            message1.appendChild(document.createTextNode(' ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'));
            
            const message2 = document.createElement('p');
            message2.textContent = 'ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚';
            
            const button = document.createElement('button');
            button.textContent = 'ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿';
            button.style.cssText = 'padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;';
            button.onclick = () => location.reload();
            
            errorDiv.appendChild(title);
            errorDiv.appendChild(message1);
            errorDiv.appendChild(message2);
            errorDiv.appendChild(button);
            
            document.body.innerHTML = '';
            document.body.appendChild(errorDiv);
        }
    </script>
    
    <script defer src="js/data-manager.js" 
            onload="console.log('âœ“ data-manager.js loaded'); console.log('DataManager check:', typeof DataManager); window.scriptLoadStatus.dataManager = true;" 
            onerror="handleScriptError('data-manager.js', event)"></script>
    
    <script defer src="js/store-manager.js" 
            onload="console.log('âœ“ store-manager.js loaded'); window.scriptLoadStatus.storeManager = true;" 
            onerror="handleScriptError('store-manager.js', event)"></script>
    
    <script defer src="js/ui-manager.js" 
            onload="console.log('âœ“ ui-manager.js loaded'); window.scriptLoadStatus.uiManager = true;" 
            onerror="handleScriptError('ui-manager.js', event)"></script>
    
    <script defer src="js/chart-manager.js" 
            onload="console.log('âœ“ chart-manager.js loaded'); window.scriptLoadStatus.chartManager = true;" 
            onerror="handleScriptError('chart-manager.js', event)"></script>
    
    <script defer src="js/app.js" 
            onload="console.log('âœ“ app.js loaded'); window.scriptLoadStatus.app = true;" 
            onerror="handleScriptError('app.js', event)"></script>
</body>

</html>