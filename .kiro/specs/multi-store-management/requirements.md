# 要件文書

## 概要

既存の会計管理システム「もうかりまっか」に複数店舗管理機能を追加し、ユーザーが複数の店舗の収支データを個別に管理・切り替えて入力できるようにします。各店舗のデータは独立して管理され、店舗間でのデータ比較や統合レポートの表示も可能にします。

## 要件

### 要件1：店舗登録・管理機能

**ユーザーストーリー:** 複数店舗を経営する事業者として、各店舗の基本情報を登録・管理したいので、店舗名、住所、開店日などの情報を設定できるようにしたい

#### 受入基準

1. WHEN 新規店舗を登録する THEN システムは店舗名、住所、開店日、備考を記録する SHALL
2. WHEN 店舗一覧を表示する THEN システムは登録されている全店舗の情報を表示する SHALL
3. WHEN 店舗情報を編集する THEN システムは既存の店舗データを更新する SHALL
4. WHEN 店舗を削除しようとする THEN システムは関連する収支データの存在を確認し、警告を表示する SHALL
5. IF 店舗名が重複している THEN システムはエラーメッセージを表示し、一意の店舗名を要求する SHALL

### 要件2：アクティブ店舗切り替え機能

**ユーザーストーリー:** 複数店舗を管理する事業者として、現在作業している店舗を簡単に切り替えたいので、ヘッダー部分で店舗を選択できるようにしたい

#### 受入基準

1. WHEN システムにアクセスする THEN システムはヘッダー部分に店舗選択ドロップダウンを表示する SHALL
2. WHEN 店舗を選択する THEN システムは選択された店舗をアクティブ店舗として設定する SHALL
3. WHEN アクティブ店舗が変更される THEN システムは現在表示中の画面を新しい店舗のデータで更新する SHALL
4. WHEN アクティブ店舗が設定される THEN システムは選択状態をローカルストレージに保存する SHALL
5. IF 店舗が登録されていない THEN システムは「店舗を登録してください」というメッセージを表示する SHALL

### 要件3：店舗別データ管理機能

**ユーザーストーリー:** 複数店舗を管理する事業者として、各店舗の収支データを独立して管理したいので、売上・仕入れ・費用などのデータが店舗ごとに分離されるようにしたい

#### 受入基準

1. WHEN 収支データを入力する THEN システムは現在のアクティブ店舗に関連付けてデータを保存する SHALL
2. WHEN データ一覧を表示する THEN システムはアクティブ店舗のデータのみを表示する SHALL
3. WHEN 店舗を切り替える THEN システムは新しい店舗のデータのみを表示する SHALL
4. WHEN データを編集・削除する THEN システムはアクティブ店舗のデータのみを対象とする SHALL
5. IF アクティブ店舗が設定されていない THEN システムはデータ入力を無効化し、店舗選択を促す SHALL

### 要件4：店舗別収支レポート機能

**ユーザーストーリー:** 複数店舗を管理する事業者として、各店舗の収支状況を個別に確認したいので、店舗ごとの月別・年別レポートを表示できるようにしたい

#### 受入基準

1. WHEN 収支レポートを表示する THEN システムはアクティブ店舗の収支データのみでレポートを生成する SHALL
2. WHEN 月別レポートを表示する THEN システムは選択された店舗の月別収支を表示する SHALL
3. WHEN 年別レポートを表示する THEN システムは選択された店舗の年別収支推移を表示する SHALL
4. WHEN グラフを表示する THEN システムは選択された店舗のデータのみでグラフを描画する SHALL
5. WHEN レポートをエクスポートする THEN システムは店舗名を含むファイル名でデータを出力する SHALL

### 要件5：全店舗統合レポート機能

**ユーザーストーリー:** 複数店舗を管理する事業者として、全店舗の収支状況を統合して確認したいので、全店舗のデータを合計した統合レポートを表示できるようにしたい

#### 受入基準

1. WHEN 統合レポートを選択する THEN システムは全店舗の収支データを合計して表示する SHALL
2. WHEN 統合月別レポートを表示する THEN システムは全店舗の月別収支合計を表示する SHALL
3. WHEN 統合年別レポートを表示する THEN システムは全店舗の年別収支推移を表示する SHALL
4. WHEN 店舗別比較を表示する THEN システムは各店舗の収支を並べて比較表示する SHALL
5. WHEN 統合レポートをエクスポートする THEN システムは全店舗のデータを含むファイルを出力する SHALL

### 要件6：店舗データのバックアップ・復元機能

**ユーザーストーリー:** 複数店舗を管理する事業者として、各店舗のデータを安全に管理したいので、店舗別または全店舗のデータをバックアップ・復元できるようにしたい

#### 受入基準

1. WHEN 店舗別バックアップを実行する THEN システムは選択された店舗のデータのみをエクスポートする SHALL
2. WHEN 全店舗バックアップを実行する THEN システムは全店舗のデータを含むファイルをエクスポートする SHALL
3. WHEN 店舗データを復元する THEN システムは指定された店舗のデータのみを復元する SHALL
4. WHEN 全店舗データを復元する THEN システムは全店舗のデータを復元する SHALL
5. IF 復元データに既存店舗と同名の店舗がある THEN システムは上書き確認ダイアログを表示する SHALL

### 要件7：店舗間データ移動機能

**ユーザーストーリー:** 複数店舗を管理する事業者として、誤って入力した店舗のデータを正しい店舗に移動したいので、収支データの店舗間移動ができるようにしたい

#### 受入基準

1. WHEN データの店舗移動を選択する THEN システムは移動対象のデータと移動先店舗の選択画面を表示する SHALL
2. WHEN 複数データを選択して移動する THEN システムは選択されたデータを一括で移動先店舗に移動する SHALL
3. WHEN データ移動を実行する THEN システムは移動履歴を記録する SHALL
4. WHEN 移動履歴を確認する THEN システムは過去の移動操作の履歴を表示する SHALL
5. IF 移動先店舗に同じ年月のデータが存在する THEN システムは重複確認ダイアログを表示する SHALL